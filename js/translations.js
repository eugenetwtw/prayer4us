// Translations for the website
const translations = {
    // Traditional Chinese (Default)
    'zh-Hant': {
        title: 'æˆ‘é™ªæ‚¨ç¦±å‘Š',
        backButton: 'â†© ä¸Šä¸€å€‹æƒ…ç·’åˆ—è¡¨',
        loadingEmotions: 'â³ æ­£åœ¨å°‹æ‰¾æ›´å¤šæƒ…ç·’...',
        customEmotionLabel: 'è«‹æè¿°æ‚¨ç›®å‰çš„å›°é›£ç‹€æ³ï¼š',
        submitButton: 'æäº¤',
        resetButton: 'é‡æ–°é¸æ“‡æƒ…ç·’',
        otherSituation: 'æˆ‘æœ‰å…¶ä»–ç‹€æ³',
        loadingVerse: 'â³ æ­£åœ¨å°‹æ‰¾åˆé©çš„ç¶“æ–‡...',
        verseForEmotion: 'ðŸ“– çµ¦æ­£åœ¨ç¶“æ­·ã€Œ{emotion}ã€çš„ä½ ï¼š',
        scripture: 'ç¶“æ–‡ï¼š',
        explanation: 'èªªæ˜Žï¼š',
        prayer: 'ç¦±å‘Šè©žï¼š',
        playPrayer: 'â–¶ æ’­æ”¾ç¦±å‘Šè©ž',
        generatingAudio: 'â³ ç”ŸæˆéŸ³é »ä¸­...',
        voiceSelector: 'é¸æ“‡è²éŸ³',
        alloy: 'Alloy (å¹³è¡¡)',
        echo: 'Echo (æ·±æ²‰)',
        fable: 'Fable (æº«æš–)',
        onyx: 'Onyx (å¼·å‹)',
        nova: 'Nova (å‹å–„)',
        shimmer: 'Shimmer (æ˜Žäº®)',
        apiKeyNotSet: 'âŒ APIé‡‘é‘°æœªè¨­ç½®ï¼Œç„¡æ³•ç²å–ç¶“æ–‡',
        errorGettingVerse: 'âŒ ç²å–ç¶“æ–‡æ™‚å‡ºéŒ¯ï¼Œè«‹ç¨å¾Œå†è©¦',
        audioPlayError: 'ç„¡æ³•æ’­æ”¾éŸ³é »ï¼Œè«‹ç¨å¾Œå†è©¦',
        parseError: 'âš ï¸ æœªèƒ½è§£æžå›žæ‡‰ï¼Œä»¥ä¸‹æ˜¯åŽŸå§‹å…§å®¹ï¼š',
        apiKeyNotSetAudio: 'APIé‡‘é‘°æœªè¨­ç½®ï¼Œç„¡æ³•æ’­æ”¾éŸ³é »',
        languageSelector: 'èªžè¨€Language'
    },
    // Simplified Chinese
    'zh-Hans': {
        title: 'æˆ‘é™ªæ‚¨ç¥·å‘Š',
        backButton: 'â†© ä¸Šä¸€ä¸ªæƒ…ç»ªåˆ—è¡¨',
        loadingEmotions: 'â³ æ­£åœ¨å¯»æ‰¾æ›´å¤šæƒ…ç»ª...',
        customEmotionLabel: 'è¯·æè¿°æ‚¨ç›®å‰çš„å›°éš¾çŠ¶å†µï¼š',
        submitButton: 'æäº¤',
        resetButton: 'é‡æ–°é€‰æ‹©æƒ…ç»ª',
        otherSituation: 'æˆ‘æœ‰å…¶ä»–çŠ¶å†µ',
        loadingVerse: 'â³ æ­£åœ¨å¯»æ‰¾åˆé€‚çš„ç»æ–‡...',
        verseForEmotion: 'ðŸ“– ç»™æ­£åœ¨ç»åŽ†ã€Œ{emotion}ã€çš„ä½ ï¼š',
        scripture: 'ç»æ–‡ï¼š',
        explanation: 'è¯´æ˜Žï¼š',
        prayer: 'ç¥·å‘Šè¯ï¼š',
        playPrayer: 'â–¶ æ’­æ”¾ç¥·å‘Šè¯',
        generatingAudio: 'â³ ç”ŸæˆéŸ³é¢‘ä¸­...',
        voiceSelector: 'é€‰æ‹©å£°éŸ³',
        alloy: 'Alloy (å¹³è¡¡)',
        echo: 'Echo (æ·±æ²‰)',
        fable: 'Fable (æ¸©æš–)',
        onyx: 'Onyx (å¼ºåŠ²)',
        nova: 'Nova (å‹å–„)',
        shimmer: 'Shimmer (æ˜Žäº®)',
        apiKeyNotSet: 'âŒ APIå¯†é’¥æœªè®¾ç½®ï¼Œæ— æ³•èŽ·å–ç»æ–‡',
        errorGettingVerse: 'âŒ èŽ·å–ç»æ–‡æ—¶å‡ºé”™ï¼Œè¯·ç¨åŽå†è¯•',
        audioPlayError: 'æ— æ³•æ’­æ”¾éŸ³é¢‘ï¼Œè¯·ç¨åŽå†è¯•',
        parseError: 'âš ï¸ æœªèƒ½è§£æžå“åº”ï¼Œä»¥ä¸‹æ˜¯åŽŸå§‹å†…å®¹ï¼š',
        apiKeyNotSetAudio: 'APIå¯†é’¥æœªè®¾ç½®ï¼Œæ— æ³•æ’­æ”¾éŸ³é¢‘',
        languageSelector: 'è¯­è¨€Language'
    },
    // English
    'en': {
        title: 'I Pray With You',
        backButton: 'â†© Previous Emotions',
        loadingEmotions: 'â³ Finding more emotions...',
        customEmotionLabel: 'Please describe your current situation:',
        submitButton: 'Submit',
        resetButton: 'Reset Emotion Selection',
        otherSituation: 'I have another situation',
        loadingVerse: 'â³ Finding appropriate scripture...',
        verseForEmotion: 'ðŸ“– For those experiencing "{emotion}":',
        scripture: 'Scripture:',
        explanation: 'Explanation:',
        prayer: 'Prayer:',
        playPrayer: 'â–¶ Play Prayer',
        generatingAudio: 'â³ Generating audio...',
        voiceSelector: 'Select Voice',
        alloy: 'Alloy (Balanced)',
        echo: 'Echo (Deep)',
        fable: 'Fable (Warm)',
        onyx: 'Onyx (Strong)',
        nova: 'Nova (Friendly)',
        shimmer: 'Shimmer (Bright)',
        apiKeyNotSet: 'âŒ API key not set, cannot retrieve scripture',
        errorGettingVerse: 'âŒ Error getting scripture, please try again later',
        audioPlayError: 'Cannot play audio, please try again later',
        parseError: 'âš ï¸ Could not parse response, here is the original content:',
        apiKeyNotSetAudio: 'API key not set, cannot play audio',
        languageSelector: 'Languageè¯­è¨€'
    },
    // Japanese
    'ja': {
        title: 'ä¸€ç·’ã«ç¥ˆã‚Šã¾ã—ã‚‡ã†',
        backButton: 'â†© å‰ã®æ„Ÿæƒ…ãƒªã‚¹ãƒˆ',
        loadingEmotions: 'â³ æ„Ÿæƒ…ã‚’æŽ¢ã—ã¦ã„ã¾ã™...',
        customEmotionLabel: 'ç¾åœ¨ã®çŠ¶æ³ã‚’èª¬æ˜Žã—ã¦ãã ã•ã„ï¼š',
        submitButton: 'é€ä¿¡',
        resetButton: 'æ„Ÿæƒ…é¸æŠžã‚’ãƒªã‚»ãƒƒãƒˆ',
        otherSituation: 'ä»–ã®çŠ¶æ³ãŒã‚ã‚Šã¾ã™',
        loadingVerse: 'â³ é©åˆ‡ãªè–æ›¸ã®è¨€è‘‰ã‚’æŽ¢ã—ã¦ã„ã¾ã™...',
        verseForEmotion: 'ðŸ“– ã€Œ{emotion}ã€ã‚’çµŒé¨“ã—ã¦ã„ã‚‹æ–¹ã¸ï¼š',
        scripture: 'è–æ›¸ï¼š',
        explanation: 'èª¬æ˜Žï¼š',
        prayer: 'ç¥ˆã‚Šï¼š',
        playPrayer: 'â–¶ ç¥ˆã‚Šã‚’å†ç”Ÿ',
        generatingAudio: 'â³ éŸ³å£°ã‚’ç”Ÿæˆä¸­...',
        voiceSelector: 'éŸ³å£°ã‚’é¸æŠž',
        alloy: 'Alloy (ãƒãƒ©ãƒ³ã‚¹)',
        echo: 'Echo (æ·±ã„)',
        fable: 'Fable (æ¸©ã‹ã„)',
        onyx: 'Onyx (åŠ›å¼·ã„)',
        nova: 'Nova (è¦ªã—ã¿ã‚„ã™ã„)',
        shimmer: 'Shimmer (æ˜Žã‚‹ã„)',
        apiKeyNotSet: 'âŒ APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€è–æ›¸ã®è¨€è‘‰ã‚’å–å¾—ã§ãã¾ã›ã‚“',
        errorGettingVerse: 'âŒ è–æ›¸ã®è¨€è‘‰ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„',
        audioPlayError: 'éŸ³å£°ã‚’å†ç”Ÿã§ãã¾ã›ã‚“ã€å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„',
        parseError: 'âš ï¸ å¿œç­”ã‚’è§£æžã§ãã¾ã›ã‚“ã§ã—ãŸã€ä»¥ä¸‹ã¯å…ƒã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ï¼š',
        apiKeyNotSetAudio: 'APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€éŸ³å£°ã‚’å†ç”Ÿã§ãã¾ã›ã‚“',
        languageSelector: 'è¨€èªžLanguage'
    }
};

// Get the current language or default to Traditional Chinese
function getCurrentLanguage() {
    return localStorage.getItem('preferredLanguage') || 'zh-Hant';
}

// Set the current language
function setCurrentLanguage(lang) {
    localStorage.setItem('preferredLanguage', lang);
    updatePageLanguage();
}

// Get a translated string
function t(key, replacements = {}) {
    const lang = getCurrentLanguage();
    const text = translations[lang][key] || translations['zh-Hant'][key] || key;
    
    // Replace any placeholders in the text
    return Object.keys(replacements).reduce((str, placeholder) => {
        return str.replace(`{${placeholder}}`, replacements[placeholder]);
    }, text);
}

// Update the page language
function updatePageLanguage() {
    const lang = getCurrentLanguage();
    
    // Update HTML lang attribute
    document.documentElement.lang = lang;
    
    // Update page title
    document.title = t('title');
    
    // Update main heading
    const mainHeading = document.querySelector('h1');
    if (mainHeading) {
        mainHeading.textContent = t('title');
    }
    
    // Update back button
    const backButton = document.getElementById('backButton');
    if (backButton) {
        backButton.textContent = t('backButton');
    }
    
    // Update any existing emotion buttons
    updateEmotionButtons();
    
    // Update verse content if it exists
    updateVerseContent();
    
    // Update voice selector if it exists
    updateVoiceSelector();
}

// Update emotion buttons with translated text
function updateEmotionButtons() {
    const mainEmotions = document.getElementById('mainEmotions');
    if (!mainEmotions) return;
    
    // Check if we're in the custom emotion input view
    const customInput = document.getElementById('customEmotionInput');
    if (customInput) {
        // Update the custom emotion input view
        const label = mainEmotions.querySelector('p');
        if (label) label.textContent = t('customEmotionLabel');
        
        const submitBtn = mainEmotions.querySelector('button:nth-of-type(1)');
        if (submitBtn) submitBtn.textContent = t('submitButton');
        
        const resetBtn = mainEmotions.querySelector('button:nth-of-type(2)');
        if (resetBtn) resetBtn.textContent = t('resetButton');
        
        return;
    }
    
    // Update regular emotion buttons
    const buttons = mainEmotions.querySelectorAll('button');
    buttons.forEach(btn => {
        if (btn.textContent === 'æˆ‘æœ‰å…¶ä»–ç‹€æ³' || 
            btn.textContent === 'æˆ‘æœ‰å…¶ä»–çŠ¶å†µ' || 
            btn.textContent === 'I have another situation' ||
            btn.textContent === 'ä»–ã®çŠ¶æ³ãŒã‚ã‚Šã¾ã™') {
            btn.textContent = t('otherSituation');
        }
    });
}

// Update verse content with translated text
function updateVerseContent() {
    const verseElement = document.getElementById('verse');
    if (!verseElement || verseElement.innerHTML.trim() === '') return;
    
    // Check if we're in the loading state
    if (verseElement.textContent.includes('æ­£åœ¨å°‹æ‰¾åˆé©çš„ç¶“æ–‡') || 
        verseElement.textContent.includes('æ­£åœ¨å¯»æ‰¾åˆé€‚çš„ç»æ–‡') || 
        verseElement.textContent.includes('Finding appropriate scripture') ||
        verseElement.textContent.includes('é©åˆ‡ãªè–æ›¸ã®è¨€è‘‰ã‚’æŽ¢ã—ã¦ã„ã¾ã™')) {
        verseElement.innerHTML = t('loadingVerse');
        return;
    }
    
    // Check if we're in the error state
    if (verseElement.textContent.includes('APIé‡‘é‘°æœªè¨­ç½®') || 
        verseElement.textContent.includes('APIå¯†é’¥æœªè®¾ç½®') || 
        verseElement.textContent.includes('API key not set') ||
        verseElement.textContent.includes('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“')) {
        verseElement.innerHTML = t('apiKeyNotSet');
        return;
    }
    
    if (verseElement.textContent.includes('ç²å–ç¶“æ–‡æ™‚å‡ºéŒ¯') || 
        verseElement.textContent.includes('èŽ·å–ç»æ–‡æ—¶å‡ºé”™') || 
        verseElement.textContent.includes('Error getting scripture') ||
        verseElement.textContent.includes('è–æ›¸ã®è¨€è‘‰ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ')) {
        verseElement.innerHTML = t('errorGettingVerse');
        return;
    }
    
    // If we have a full verse display, update the labels but keep the content
    const h3 = verseElement.querySelector('h3');
    if (h3) {
        // Extract the emotion from the heading
        const emotionMatch = h3.textContent.match(/ã€Œ(.+?)ã€/) || h3.textContent.match(/"(.+?)"/);
        const emotion = emotionMatch ? emotionMatch[1] : '';
        
        h3.textContent = t('verseForEmotion', { emotion });
    }
    
    // Update the scripture, explanation, and prayer labels
    const paragraphs = verseElement.querySelectorAll('p');
    if (paragraphs.length >= 3) {
        const scriptureStrong = paragraphs[0].querySelector('strong');
        if (scriptureStrong) scriptureStrong.textContent = t('scripture');
        
        const explanationStrong = paragraphs[1].querySelector('strong');
        if (explanationStrong) explanationStrong.textContent = t('explanation');
        
        const prayerStrong = paragraphs[2].querySelector('strong');
        if (prayerStrong) prayerStrong.textContent = t('prayer');
    }
    
    // Update the play button text
    const playButton = document.getElementById('play-text');
    if (playButton) playButton.textContent = t('playPrayer');
    
    const loadingSpinner = document.getElementById('loading-spinner');
    if (loadingSpinner) loadingSpinner.textContent = t('generatingAudio');
    
    // Update voice selector label
    const voiceSelectorLabel = document.getElementById('voice-selector-label');
    if (voiceSelectorLabel) voiceSelectorLabel.textContent = t('voiceSelector') + ':';
}

// Update voice selector with translated text
function updateVoiceSelector() {
    const voiceSelector = document.getElementById('voice-selector');
    if (!voiceSelector) return;
    
    // Update voice options
    Array.from(voiceSelector.options).forEach(option => {
        const voiceKey = option.value.toLowerCase();
        if (translations[getCurrentLanguage()][voiceKey]) {
            option.textContent = translations[getCurrentLanguage()][voiceKey];
        }
    });
}

// Initialize language on page load
document.addEventListener('DOMContentLoaded', updatePageLanguage);
